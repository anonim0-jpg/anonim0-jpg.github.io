<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap');
        /* --- ESTÉTICA DARK GLASS --- */
        :root {
            --glass-bg: rgba(0, 0, 0, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            --text-color: rgba(255, 255, 255, 0.95);
            
            /* --- COLORES DEFINITIVOS --- */
            /* Serpiente: AZUL CIAN (Cyan) */
            --snake-head: #00f2ff; 
            --snake-body: rgba(0, 242, 255, 0.5);
            
            /* Fruta: ROJO INTENSO */
            --food-color: #ff2a2a;
            --food-glow: #ff2a2a; 
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Ubuntu', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            /* Fondo elegante oscuro */
            background: linear-gradient(-45deg, #0f172a, #1e293b, #0f172a, #000000);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            touch-action: none; /* Bloquea zoom en móviles */
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- CONTENEDOR DE CRISTAL --- */
        .glass-panel {
            position: relative;
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding: 1.5rem;
            text-align: center;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            width: 90%;
            max-width: 450px;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* --- CANVAS --- */
        .canvas-container {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        canvas {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            width: 100%;
            aspect-ratio: 1 / 1;
            display: block;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
        }

        /* --- PANTALLA START / GAME OVER --- */
        #gameOverlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
            z-index: 10;
        }

        #gameOverlay h2 { 
            margin: 0; 
            font-weight: 800; 
            font-size: 2.5rem; 
            color: var(--snake-head);
            text-shadow: 0 0 20px rgba(0, 242, 255, 0.5);
        }

        button.start-btn {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 15px 40px;
            border-radius: 50px;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        button.start-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }

        /* --- CONTROLES MÓVIL --- */
        .mobile-controls {
            display: none;
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(3, 70px);
            grid-template-rows: repeat(2, 70px);
            gap: 10px;
            justify-content: center;
        }

        @media (max-width: 800px), (hover: none) {
            .mobile-controls { display: grid; }
            .keyboard-hint { display: none; }
        }

        .ctrl-btn {
            width: 70px; height: 70px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .ctrl-btn:active { background: rgba(255, 255, 255, 0.2); color: #fff; transform: translateY(2px); }
        
        /* Grid Layout para cruceta */
        .btn-up { grid-column: 2; grid-row: 1; }
        .btn-left { grid-column: 1; grid-row: 2; }
        .btn-right { grid-column: 3; grid-row: 2; }
        .btn-down { grid-column: 2; grid-row: 2; }

        .keyboard-hint { font-size: 0.9rem; opacity: 0.6; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="glass-panel">
        <div class="stats">
            <span style="color: var(--snake-head);">SNAKE</span>
            <span>SCORE: <span id="score">0</span></span>
        </div>
        
        <div class="canvas-container">
            <canvas id="gameCanvas" width="400" height="400"></canvas>
            
            <div id="gameOverlay">
                <h2 id="overlayTitle">SNAKE</h2>
                <button class="start-btn" onclick="startGameBtn()">JUGAR</button>
            </div>
        </div>

        <div class="mobile-controls">
            <div class="ctrl-btn btn-up" id="btnUp">↑</div>
            <div class="ctrl-btn btn-left" id="btnLeft">←</div>
            <div class="ctrl-btn btn-right" id="btnRight">→</div>
            <div class="ctrl-btn btn-down" id="btnDown">↓</div>
        </div>

        <div class="keyboard-hint">Usa las flechas del teclado</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const overlay = document.getElementById('gameOverlay');
        const overlayTitle = document.getElementById('overlayTitle');
        const startBtnTag = document.querySelector('.start-btn');

        // Configuración Juego
        const gridSize = 20;
        const tileCount = 400 / gridSize; // 20x20
        
        let speed = 7;
        let score = 0;
        let velocityX = 0;
        let velocityY = 0;
        let snake = [];
        let food = { x: 5, y: 5 };
        
        let gameInterval = null;
        let isGameRunning = false;
        let hasStartedMoving = false; // Bloqueo hasta pulsar tecla

        // Posiciones iniciales
        let headX = 10;
        let headY = 10;
        let tailLength = 2;

        function startGameBtn() {
            if (isGameRunning) return;
            resetAndStart();
        }

        function resetAndStart() {
            headX = 10; headY = 10;
            snake = [];
            tailLength = 2;
            score = 0;
            speed = 7;
            velocityX = 0; velocityY = 0;
            hasStartedMoving = false;
            scoreElement.innerText = score;
            
            overlay.style.display = 'none';
            isGameRunning = true;
            
            spawnFood();
            
            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, 1000 / speed);
        }

        function gameLoop() {
            if (!hasStartedMoving) {
                drawEverything();
                return;
            }

            headX += velocityX;
            headY += velocityY;

            // Chocar paredes
            if (headX < 0 || headX >= tileCount || headY < 0 || headY >= tileCount) {
                gameOver();
                return;
            }

            // Comer Fruta
            if (headX === food.x && headY === food.y) {
                score += 10;
                scoreElement.innerText = score;
                tailLength++;
                spawnFood();
                // Acelerar un poco
                if(score % 50 === 0) {
                    speed += 0.5;
                    clearInterval(gameInterval);
                    gameInterval = setInterval(gameLoop, 1000 / speed);
                }
            }

            // Mover cuerpo
            snake.push({ x: headX, y: headY });
            while (snake.length > tailLength) {
                snake.shift();
            }

            // Chocar consigo mismo
            for (let i = 0; i < snake.length - 1; i++) {
                if (snake[i].x === headX && snake[i].y === headY) {
                    gameOver();
                    return;
                }
            }

            drawEverything();
        }

        function drawEverything() {
            // Limpiar
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // --- 1. DIBUJAR FRUTA (ROJA) ---
            ctx.shadowBlur = 20;
            ctx.shadowColor = "red"; // Resplandor rojo
            ctx.fillStyle = "#ff2a2a"; // Color sólido rojo
            
            ctx.beginPath();
            let fx = (food.x * gridSize) + gridSize/2;
            let fy = (food.y * gridSize) + gridSize/2;
            ctx.arc(fx, fy, gridSize/2 - 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0; // Quitar sombra para lo siguiente

            // --- 2. DIBUJAR SERPIENTE (AZUL) ---
            for (let i = 0; i < snake.length; i++) {
                // Cabeza sólida, cuerpo transparente
                ctx.fillStyle = (i === snake.length - 1) ? "var(--snake-head)" : "var(--snake-body)";
                
                let size = gridSize - 2;
                let x = snake[i].x * gridSize + 1;
                let y = snake[i].y * gridSize + 1;
                
                ctx.beginPath();
                if (ctx.roundRect) ctx.roundRect(x, y, size, size, 5);
                else ctx.fillRect(x, y, size, size);
                ctx.fill();
            }
            
            // Dibujo inicial estático (cabeza quieta)
            if(snake.length === 0 && isGameRunning) {
                 ctx.fillStyle = "var(--snake-head)";
                 let x = headX*gridSize+1, y = headY*gridSize+1, s = gridSize-2;
                 if (ctx.roundRect) { ctx.beginPath(); ctx.roundRect(x, y, s, s, 5); ctx.fill(); }
                 else ctx.fillRect(x, y, s, s);
            }
        }

        function spawnFood() {
            food.x = Math.floor(Math.random() * tileCount);
            food.y = Math.floor(Math.random() * tileCount);
            // Evitar que nazca sobre la serpiente
            for (let part of snake) {
                if (food.x === part.x && food.y === part.y) {
                    spawnFood(); return;
                }
            }
            if(food.x === headX && food.y === headY) spawnFood();
        }

        function gameOver() {
            isGameRunning = false;
            clearInterval(gameInterval);
            overlayTitle.innerText = "GAME OVER";
            startBtnTag.innerText = "REINICIAR";
            overlay.style.display = 'flex';
        }

        function changeDirection(dir) {
            if (!isGameRunning) return;
            if (!hasStartedMoving) hasStartedMoving = true;

            switch(dir) {
                case 'UP': if (velocityY !== 1) { velocityX = 0; velocityY = -1; } break;
                case 'DOWN': if (velocityY !== -1) { velocityX = 0; velocityY = 1; } break;
                case 'LEFT': if (velocityX !== 1) { velocityX = -1; velocityY = 0; } break;
                case 'RIGHT': if (velocityX !== -1) { velocityX = 1; velocityY = 0; } break;
            }
        }

        // Teclado
        document.addEventListener('keydown', (e) => {
            if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(e.key)) e.preventDefault();
            
            if (!isGameRunning && overlay.style.display !== 'none') {
                if(e.key === "Enter" || e.key === " ") resetAndStart();
                return;
            }

            switch (e.key) {
                case "ArrowUp": changeDirection('UP'); break;
                case "ArrowDown": changeDirection('DOWN'); break;
                case "ArrowLeft": changeDirection('LEFT'); break;
                case "ArrowRight": changeDirection('RIGHT'); break;
            }
        });

        // Móvil
        ['btnUp','btnDown','btnLeft','btnRight'].forEach(id => {
            document.getElementById(id).addEventListener('touchstart', (e) => {
                e.preventDefault();
                changeDirection(id.replace('btn','').toUpperCase());
            }, {passive: false});
        });

        // Primer dibujado
        drawEverything();

    </script>
</body>
</html>