<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego 2048</title>
    <link rel="stylesheet" href="2048.css">
</head>
<body>
    <div class="game-container">
        <h1>2048</h1>
        <div id="score-container">
            <div id="score">Puntuaci贸n: 0</div>
            <div id="best-score">Mejor Puntuaci贸n: 0</div>
        </div>
        <div id="grid-container"></div>
        <button id="reset-button">Reiniciar</button>
    </div>

    <script>
        const gridContainer = document.getElementById('grid-container');
        const scoreDisplay = document.getElementById('score');
        const bestScoreDisplay = document.getElementById('best-score');
        const resetButton = document.getElementById('reset-button');
        let grid = Array(4).fill().map(() => Array(4).fill(0));
        let score = 0;
        let bestScore = localStorage.getItem('bestScore') || 0;

        function createTile(value) {
            const tile = document.createElement('div');
            tile.className = `tile tile-${value}`;
            tile.textContent = value !== 0 ? value : '';
            return tile;
        }

        function drawGrid() {
            gridContainer.innerHTML = '';
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    gridContainer.appendChild(createTile(grid[row][col]));
                }
            }
            scoreDisplay.textContent = `Puntuaci贸n: ${score}`;
            bestScoreDisplay.textContent = `Mejor Puntuaci贸n: ${bestScore}`;
        }

        function spawnTile() {
            let emptyTiles = [];
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    if (grid[row][col] === 0) emptyTiles.push([row, col]);
                }
            }
            if (emptyTiles.length > 0) {
                const [row, col] = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
                grid[row][col] = Math.random() < 0.9 ? 2 : 4;
            }
        }

        function slide(row) {
            row = row.filter(val => val);
            while (row.length < 4) row.push(0);
            return row;
        }

        function combine(row) {
            for (let i = 0; i < 3; i++) {
                if (row[i] === row[i + 1] && row[i] !== 0) {
                    row[i] *= 2;
                    score += row[i];
                    row[i + 1] = 0;
                }
            }
            return row;
        }

        function moveLeft() {
            for (let row = 0; row < 4; row++) {
                grid[row] = slide(combine(slide(grid[row])));
            }
        }

        function rotateGrid() {
            let newGrid = Array(4).fill().map(() => Array(4).fill(0));
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    newGrid[row][col] = grid[col][3 - row];
                }
            }
            grid = newGrid;
        }

        function move(direction) {
            if (direction === 'left') moveLeft();
            else if (direction === 'right') {
                rotateGrid();
                rotateGrid();
                moveLeft();
                rotateGrid();
                rotateGrid();
            } else if (direction === 'up') {
                rotateGrid();
                rotateGrid();
                rotateGrid();
                moveLeft();
                rotateGrid();
            } else if (direction === 'down') {
                rotateGrid();
                moveLeft();
                rotateGrid();
                rotateGrid();
                rotateGrid();
            }
            spawnTile();
            drawGrid();
            updateBestScore();
        }

        function updateBestScore() {
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('bestScore', bestScore);
            }
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowLeft') move('left');
            else if (event.key === 'ArrowRight') move('right');
            else if (event.key === 'ArrowUp') move('down');
            else if (event.key === 'ArrowDown') move('up');
        });

        resetButton.addEventListener('click', () => {
            score = 0;
            grid = Array(4).fill().map(() => Array(4).fill(0));
            spawnTile();
            spawnTile();
            drawGrid();
        });

        spawnTile();
        spawnTile();
        drawGrid();
    </script>
</body>
</html>
